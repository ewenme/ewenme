legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = "left",
panel.border = element_blank()
)
# read shapefile
fl_shp <- counties(state = "FL")
fl_shp <- st_as_sf(fl_shp)
fl_shp <- fl_shp %>%
mutate(COUNTYFP=as.numeric(paste0("12", COUNTYFP))) %>%
left_join(county_counts, by=c("COUNTYFP"="county_fips"))
# plots stops by county
ggplot(fl_shp) +
geom_sf(aes(fill = stop_quantile)) +
scale_fill_viridis_c("No. of Stops", option = "magma",
guide = guide_colorbar(
direction = "vertical",
barheight = unit(50, units = "mm"),
barwidth = unit(2, units = "mm"),
draw.ulim = F,
title.position = 'top')) +
ggtitle("Motorist stops by Police in counties in Florida") +
theme_minimal() +
theme(
axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
# panel.grid.minor = element_line(color = "#ebebe5", size = 0.2),
panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
panel.grid.minor = element_blank(),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = "left",
panel.border = element_blank()
)
ggplot(fl_shp) +
geom_sf(aes(fill = stop_quantile)) +
scale_fill_viridis_c("No. of Stops", option = "magma",
guide = guide_colorbar(
direction = "vertical",
barheight = unit(50, units = "mm"),
barwidth = unit(2, units = "mm"),
draw.ulim = F,
title.position = 'top')) +
ggtitle("Motorist stops by Police in counties in Florida") +
caption("data from openpolicing.stanford.edu/data  |  @ewen_")
theme_minimal() +
theme(
axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
# panel.grid.minor = element_line(color = "#ebebe5", size = 0.2),
panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
panel.grid.minor = element_blank(),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = "left",
panel.border = element_blank()
)
plots stops by county
ggplot(fl_shp) +
geom_sf(aes(fill = stop_quantile)) +
scale_fill_viridis_c("No. of Stops", option = "magma",
guide = guide_colorbar(
direction = "vertical",
barheight = unit(50, units = "mm"),
barwidth = unit(2, units = "mm"),
draw.ulim = F,
title.position = 'top')) +
ggtitle("Motorist stops by Police in counties in Florida") +
caption("data from openpolicing.stanford.edu/data  |  @ewen_") +
theme_minimal() +
theme(
axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
# panel.grid.minor = element_line(color = "#ebebe5", size = 0.2),
panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
panel.grid.minor = element_blank(),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = "left",
panel.border = element_blank()
)
ggplot(fl_shp) +
geom_sf(aes(fill = stop_quantile)) +
scale_fill_viridis_c("No. of Stops", option = "magma",
guide = guide_colorbar(
direction = "vertical",
barheight = unit(50, units = "mm"),
barwidth = unit(2, units = "mm"),
draw.ulim = F,
title.position = 'top')) +
labs(title="Motorist stops by Police in counties in Florida",
caption="data from openpolicing.stanford.edu/data  |  @ewen_") +
theme_minimal() +
theme(
axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
# panel.grid.minor = element_line(color = "#ebebe5", size = 0.2),
panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
panel.grid.minor = element_blank(),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = "left",
panel.border = element_blank()
)
ggplot(fl_shp) +
geom_sf(aes(fill = stop_quantile)) +
scale_fill_viridis_c("No. of Stops", option = "magma",
guide = guide_colorbar(
direction = "vertical",
barheight = unit(50, units = "mm"),
barwidth = unit(2, units = "mm"),
draw.ulim = F,
title.position = 'top')) +
labs(title="Motorist stops by Police in counties in Florida",
caption="data from openpolicing.stanford.edu | @ewen_") +
theme_minimal() +
theme(
axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
# panel.grid.minor = element_line(color = "#ebebe5", size = 0.2),
panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
panel.grid.minor = element_blank(),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = "left",
panel.border = element_blank()
)
ggplot(fl_shp) +
geom_sf(aes(fill = stop_quantile), colour="white") +
scale_fill_viridis_c("No. of Stops", option = "magma",
guide = guide_colorbar(
direction = "vertical",
barheight = unit(50, units = "mm"),
barwidth = unit(2, units = "mm"),
draw.ulim = F,
title.position = 'top')) +
labs(title="Motorist stops by Police in counties in Florida",
caption="data from openpolicing.stanford.edu | @ewen_") +
theme_minimal() +
theme(
axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
# panel.grid.minor = element_line(color = "#ebebe5", size = 0.2),
panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
panel.grid.minor = element_blank(),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = "left",
panel.border = element_blank()
)
ggplot(fl_shp) +
geom_sf(aes(fill = stop_quantile), colour="white") +
scale_fill_viridis_c("No. of Stops", option = "magma",
guide = guide_colorbar(
direction = "vertical",
barheight = unit(50, units = "mm"),
barwidth = unit(2, units = "mm"),
draw.ulim = F,
title.position = 'top')) +
labs(title="Motorist stops by Police in counties in Florida",
caption="data from openpolicing.stanford.edu | @ewen_") +
theme_minimal() +
theme(
text = element_text(family = "Work Sans") +
axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
# panel.grid.minor = element_line(color = "#ebebe5", size = 0.2),
panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
panel.grid.minor = element_blank(),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = "left",
panel.border = element_blank()
)
ggplot(fl_shp) +
geom_sf(aes(fill = stop_quantile), colour="white") +
scale_fill_viridis_c("No. of Stops", option = "magma",
guide = guide_colorbar(
direction = "vertical",
barheight = unit(50, units = "mm"),
barwidth = unit(2, units = "mm"),
draw.ulim = F,
title.position = 'top')) +
labs(title="Motorist stops by Police in counties in Florida",
caption="data from openpolicing.stanford.edu | @ewen_") +
theme_minimal() +
theme(
text = element_text(family = "Work Sans"),
axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
# panel.grid.minor = element_line(color = "#ebebe5", size = 0.2),
panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
panel.grid.minor = element_blank(),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = "left",
panel.border = element_blank()
)
ggplot(fl_shp) +
geom_sf(aes(fill = stop_quantile), colour="white") +
scale_fill_viridis_c("No. of Stops", option = "magma",
guide = guide_colorbar(
direction = "vertical",
barheight = unit(50, units = "mm"),
barwidth = unit(2, units = "mm"),
draw.ulim = F,
title.position = 'top')) +
labs(title="Motorist stops by Police in counties in Florida",
caption="data from openpolicing.stanford.edu | @ewen_") +
theme_minimal() +
theme(
title = element_text(family = "Work Sans"),
axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
# panel.grid.minor = element_line(color = "#ebebe5", size = 0.2),
panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
panel.grid.minor = element_blank(),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = "left",
panel.border = element_blank()
)
# plots stops by county
ggplot(fl_shp) +
geom_sf(aes(fill = stop_quantile), colour="white") +
scale_fill_viridis_c("No. of Stops", option = "magma",
guide = guide_colorbar(
direction = "vertical",
barheight = unit(50, units = "mm"),
barwidth = unit(2, units = "mm"),
draw.ulim = F,
title.position = 'top')) +
labs(title="Motorist stops by Police in counties in Florida",
caption="data from openpolicing.stanford.edu | @ewen_") +
theme_minimal() +
theme(
axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
# panel.grid.minor = element_line(color = "#ebebe5", size = 0.2),
panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
panel.grid.minor = element_blank(),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = "left",
panel.border = element_blank()
)
plots stops by county
ggplot(fl_shp) +
geom_sf(aes(fill = stop_quantile), colour="white") +
scale_fill_viridis_c("No. of Stops", option = "magma",
guide = guide_colorbar(
direction = "vertical",
barheight = unit(30, units = "mm"),
barwidth = unit(2, units = "mm"),
draw.ulim = F,
title.position = 'top')) +
labs(title="Motorist stops by Police in counties in Florida",
caption="data from openpolicing.stanford.edu | @ewen_") +
theme_minimal() +
theme(
axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
# panel.grid.minor = element_line(color = "#ebebe5", size = 0.2),
panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
panel.grid.minor = element_blank(),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = "left",
panel.border = element_blank()
)
ggplot(fl_shp) +
geom_sf(aes(fill = stop_count), colour="white") +
scale_fill_viridis_c("No. of Stops", option = "magma",
guide = guide_colourbar(
direction = "vertical",
barheight = unit(30, units = "mm"),
barwidth = unit(2, units = "mm"),
draw.ulim = F, nbin = 5,
title.position = 'top')) +
labs(title="Motorist stops by Police in counties in Florida",
caption="data from openpolicing.stanford.edu | @ewen_") +
theme_minimal() +
theme(
axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
# panel.grid.minor = element_line(color = "#ebebe5", size = 0.2),
panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
panel.grid.minor = element_blank(),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = "left",
panel.border = element_blank()
)
ggplot(fl_shp) +
geom_sf(aes(fill = stop_count), colour="white") +
scale_fill_viridis_c("No. of Stops", option = "magma", formatter="comma",
guide = guide_colourbar(
direction = "vertical",
barheight = unit(30, units = "mm"),
barwidth = unit(2, units = "mm"),
draw.ulim = F,
title.position = 'top')) +
labs(title="Motorist stops by Police in counties in Florida",
caption="data from openpolicing.stanford.edu | @ewen_") +
theme_minimal() +
theme(
axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
# panel.grid.minor = element_line(color = "#ebebe5", size = 0.2),
panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
panel.grid.minor = element_blank(),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = "left",
panel.border = element_blank()
)
plots stops by county
ggplot(fl_shp) +
geom_sf(aes(fill = stop_count), colour="white") +
scale_fill_viridis_c("No. of Stops", option = "magma", labels="comma",
guide = guide_colourbar(
direction = "vertical",
barheight = unit(30, units = "mm"),
barwidth = unit(2, units = "mm"),
draw.ulim = F,
title.position = 'top')) +
labs(title="Motorist stops by Police in counties in Florida",
caption="data from openpolicing.stanford.edu | @ewen_") +
theme_minimal() +
theme(
axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
# panel.grid.minor = element_line(color = "#ebebe5", size = 0.2),
panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
panel.grid.minor = element_blank(),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = "left",
panel.border = element_blank()
)
library(scales)
# plots stops by county
ggplot(fl_shp) +
geom_sf(aes(fill = stop_count), colour="white") +
scale_fill_viridis_c("No. of Stops", option = "magma", labels="comma",
guide = guide_colourbar(
direction = "vertical",
barheight = unit(30, units = "mm"),
barwidth = unit(2, units = "mm"),
draw.ulim = F,
title.position = 'top')) +
labs(title="Motorist stops by Police in counties in Florida",
caption="data from openpolicing.stanford.edu | @ewen_") +
theme_minimal() +
theme(
axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
# panel.grid.minor = element_line(color = "#ebebe5", size = 0.2),
panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
panel.grid.minor = element_blank(),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = "left",
panel.border = element_blank()
)
ggplot(fl_shp) +
geom_sf(aes(fill = stop_count), colour="white") +
scale_fill_viridis_c("No. of Stops", option = "magma", labels = comma,
guide = guide_colourbar(
direction = "vertical",
barheight = unit(30, units = "mm"),
barwidth = unit(2, units = "mm"),
draw.ulim = F,
title.position = 'top')) +
labs(title="Motorist stops by Police in counties in Florida",
caption="data from openpolicing.stanford.edu | @ewen_") +
theme_minimal() +
theme(
axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
# panel.grid.minor = element_line(color = "#ebebe5", size = 0.2),
panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
panel.grid.minor = element_blank(),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = "left",
panel.border = element_blank()
)
# plots stops by county
ggplot(fl_shp) +
geom_sf(aes(fill = stop_count), colour="white") +
scale_fill_viridis_c("No. of Stops", option = "magma", labels = comma,
alpha = 0.8,
guide = guide_colourbar(
direction = "vertical",
barheight = unit(30, units = "mm"),
barwidth = unit(2, units = "mm"),
draw.ulim = F,
title.position = 'top')) +
labs(title="Motorist stops by Police in Florida",
caption="data from openpolicing.stanford.edu | @ewen_") +
theme_minimal() +
theme(
axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
# panel.grid.minor = element_line(color = "#ebebe5", size = 0.2),
panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
panel.grid.minor = element_blank(),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
legend.position = "left",
panel.border = element_blank()
)
county_counts <- tbl(sc, "fl_stops") %>%
group_by(county_name, county_fips) %>%
summarise(stop_count=n(), arrest_count=sum(is_arrested=="TRUE"),
search_count=sum(search_conducted=="TRUE")) %>%
collect()
county_counts <- tbl(sc, "fl_stops") %>%
group_by(county_name, county_fips) %>%
summarise(stop_count=n(), arrest_count=sum(is_arrested == "TRUE"),
search_count=sum(search_conducted == "TRUE")) %>%
collect()
county_counts <- tbl(sc, "fl_stops") %>%
group_by(county_name, county_fips, is_arrested, search_conducted) %>%
summarise(count=n()) %>%
collect()
View(county_counts)
