---
title: '...xPoints?'
description: "Translating advanced player performance metrics into fantasy football points potential."
date: '2019-03-04'
slug: xPoints
tags: ["football", "fpl"]
draft: yes
---

To anyone paying attention over the last couple of years, some "advanced" football metrics (or expected goals, at least) seem to have successfully navigated the five stages of ~~grief~~ haranguing from the media charged with upholding the "magic" of the game. Imagine peak Lawrenson and Hansen placed in this scene:

<blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">The stats don&#39;t look great but <a href="https://twitter.com/jjenas8?ref_src=twsrc%5Etfw">@jjenas8</a> says Brighton will be fine. <a href="https://twitter.com/hashtag/motd2?src=hash&amp;ref_src=twsrc%5Etfw">#motd2</a> <a href="https://t.co/JrXglJEy96">pic.twitter.com/JrXglJEy96</a></p>&mdash; Match of the Day (@BBCMOTD) <a href="https://twitter.com/BBCMOTD/status/1094731648178913280?ref_src=twsrc%5Etfw">10 February 2019</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

Back in August 2017, StatsBomb's Ted Knutson [predicted](https://statsbomb.com/2017/08/xg-is-on-tv-now-what/), among other things, that the relentless xG circus would:

> Create an entire new generation of highly educated fans and coaches who view the game itself in a more knowledgeable light.

[Fantasy Premier League](https://fantasy.premierleague.com/) (FPL) is the official fantasy football game of the [Premier League](https://en.wikipedia.org/wiki/Premier_League), with more than five million "managers" (plus many thousands of passive agressive workplace league rivalries) and counting. FPL managers, particularly those taking it seriously/semi-seriously, probably represent an early adopter population in Ted's above prophecy - fans with a vested interest in gaining competitive advantage. It definitely shows...Michael Caley [chatting to the FML FPL podcast](http://fmlfpl.libsyn.com/ep-161-fireside-chat-with-michael-caley) recently, for one.

I think there's some appetite around for this stuff. What's also interesting to me is that, as an application of metrics like expected goals (xG), fantasy football player evaluation is a far simpler optimisation problem than the real thing. Especially for attacking players, FPL player evaluation is predominantly about *individual goal contributions* (goals and assists) because they result in *points* (three for an assist, while grabbing a goal equals four or five points for midfielders and forwards respectively). Other contributions to general play can be glossed over for the most part, even the "pre-assist", hence why the original FPL valuation for N'Golo Kanté (£5.0m) was so much lower than Sadio Mané's (£9.5m) in the current (2018/19) season.

Therefore, a useful FPL evaluation of attacking players could be made using metrics that quantify activity at the very sharp end of attacking moves, namely a combination of:

- **xG:** How many goals should a player have scored on average, given the shots they took?
- **xA:** How many assists should a player have provided on average, given the passes they made?

These can subsequently be combined to form an **expected goals contributions** measure, and thus a shorthand for understanding which attacking FPL assets to consider. So, what's the hold-up?

## Some things I made earlier

Turns out that getting at the data should be quite simple - I've already authored a pair of R packages ready for the job. 

Both can be installed from GitHub using another library, [remotes](https://github.com/r-lib/remotes):

```{r install}
remotes::install_github(c("ewenme/fplr", "ewenme/understatr"))
```

[fplr](https://ewenme.github.io/fplr/) helps get data on FPL players...

```{r get-fpl-data}
library(fplr)

fpl_data <- fpl_get_players()

fpl_data
```

...and [understatr](https://github.com/ewenme/understatr) can help fetch [understat](https://understat.com/) data:

```{r get-understat-data}
library(understatr)

# get EPL team data
epl_team_stats <- get_league_teams_stats(league_name = "EPL", year = 2018)

# get EPL player data
epl_player_stats <- purrr::map_dfr(unique(epl_team_stats$team_name), get_team_players_stats, year = 2018)

epl_player_stats
```

A bit of cleaning is required to be able to join the datasets (e.g. standardising team/player names), but otherwise we're good to get numbers on the board.

```{r data-cleaning}
library(dplyr)
library(stringr)
library(fuzzyjoin)

# club name disparities
club_names <- c("Man City"="Manchester City", "Man Utd"=" Manchester United", 
                "Wolves"=" Wolverhampton Wanderers", "Newcastle"=" Newcastle United",
                "Spurs"="Tottenham")

# replace club name aliases
fpl_data$team_name <- str_replace_all(fpl_data$team_name, pattern = club_names)

# create full player names
fpl_data$player_name <- paste(fpl_data$first_name, fpl_data$second_name)

# create web name equivalent
epl_player_stats$web_name <- sub(".*? (.+)", "\\1", epl_player_stats$player_name)

# fix known differences
epl_player_stats$web_name[epl_player_stats$player_name == "David Silva"] <- "David Silva"
epl_player_stats$web_name[epl_player_stats$player_name == "Bernardo Silva"] <- "Bernardo Silva"
epl_player_stats$web_name[epl_player_stats$player_name == "Felipe Anderson"] <- "Felipe Anderson"
epl_player_stats$web_name[epl_player_stats$player_name == "Son Heung-Min"] <- "Son"

# select fields
epl_player_stats <- select(epl_player_stats, -year, -yellow_cards:-position)
fpl_data <- select(fpl_data, -photo, -team_code:-news, 
                      -news_added:-value_season, -in_dreamteam, -dreamteam_count,
                      -form:-loaned_out, -ep_this:-special, -own_goals:-team)

# fuzzy join understat/fpl player data
player_stats <- stringdist_left_join(fpl_data, epl_player_stats,
                                     by = c("web_name", "team_name"),
                                     max_dist = 2)

# check missing players
missing <- filter(player_stats, is.na(player_id))

# remove extra fields
player_stats <- player_stats %>% 
  select(-team_name.y, -player_name.y, -web_name.y) %>% 
  rename(team_name=team_name.x, player_name=player_name.x, web_name=web_name.x)
```



## Speaking different languages



- expressing expected goal contributions as points
- understanding value
- normalising for minutes
