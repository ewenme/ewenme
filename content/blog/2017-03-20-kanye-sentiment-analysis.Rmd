---
title: "A sentiment analysis of Kanye West records"
description: "Using sentiment analysis techniques to explore Ye's art."
date: "2017-03-20"
tags: ["r", "text-mining", "music"]
slug: kanye-sentiment-analysis
draft: no
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(cache = TRUE, echo = TRUE, warning = FALSE, message = FALSE, out.width = '100%', dpi = 180)

library(tidyverse)
library(hrbrthemes)
library(tidytext)
library(forcats)
library(ggalt)
library(broom)

# load data
df <- readRDS("../data/kanye.Rda")

# remove track part cues
df$lyrics <- gsub("\\[[^\\]]*\\]", "", df$lyrics, perl=TRUE)

df$duration <- as.numeric(df$duration)

#make album an ordered factor
df$album <- fct_inorder(as.factor(df$album))

#turn the data into one row, one word, and remove stop words
tidy_df <- df %>%
  unnest_tokens(word, lyrics) %>%
  filter(!word %in% c("la", "uh"))

#censor some things
tidy_df$word[tidy_df$word == "nigga"] <- "n**ga"
tidy_df$word[tidy_df$word == "niggas"] <- "n**gas"
tidy_df$word[tidy_df$word == "shit"] <- "s**t"
tidy_df$word[tidy_df$word == "fuck"] <- "f**k"

#sentiment_df
sentiment_df <- df %>%
  unnest_tokens(word, lyrics) %>%
  anti_join(stop_words) %>%
  filter(!word %in% c("la", "uh"))

#censor some things
sentiment_df$word[sentiment_df$word == "nigga"] <- "n**ga"
sentiment_df$word[sentiment_df$word == "niggas"] <- "n**gas"
sentiment_df$word[sentiment_df$word == "shit"] <- "s**t"
sentiment_df$word[sentiment_df$word == "fuck"] <- "f**k"
```

Kanye West is responsible for some of the realest, funniest (*"if you fall on the concrete thats your ass fault"*...ass fault...asphalt...anyone?) and inspiring lyrics in music, period. Can the application of sentiment analysis techniques help us understand more about his art?[^fullcode]

This is **not** a sentiment analysis of the music per se - nothing in here about keys, tempo, melody or any other components of music that influence the emotional valence of the piece[^RCharlie] - the analysis is reflective of the lyrical content only, while the sample is limited to Ye's solo studio albums (album editions taken from Last.fm [here](https://www.last.fm/music/Kanye+West/+albums)). Also, the analysis includes lyrics from artists featured on the records, so is representative of the body of work rather than the individual.

```{r echo = FALSE, out.width = "75%", fig.align = "center"}
knitr::include_graphics("/img/2017-03-20-Kanye_sentiment_analysis/808s_heart.jpg")
```

## First look

To begin with, a simple look at Ye's lyric count by album:

```{r echo=FALSE}

tidy_df %>%
  count(n(), album) %>%
  ggplot(aes(x=n, y=fct_rev(album))) +
  geom_lollipop(point.colour="firebrick", point.size=2, horizontal=TRUE) +
  scale_x_comma(breaks = seq(0, 15000, by=2500), limits = c(0, 15000)) +
  theme_ipsum(grid="X", base_size = 14, axis_title_size = 14, caption_size = 12,
              plot_title_size = 18, subtitle_size = 14) +
  labs(title="How many words are in Kanye West albums?",
       x=NULL,
       y=NULL,
       subtitle="Records in chronological order",
       caption="Lyric data from genius.com")
```

*The College Dropout* is clearly the album with biggest (lyrical) bang for your buck, registering **13,679 words**. *808s & Heartbreak* and *Yeezus* lag the farthest behind (below five-thousand a piece, and around one-third of *College Dropout*), and with good reason - *808s* is memorably less lyrically dense than the others, while the latter has the smallest number of tracks. 

We can normalise by track length and give a measure of 'lyrical density' (words-per-second) across time:

```{r}
album_df <- tidy_df %>%
  count(n(), album) 

album_df_b <- df %>%
  group_by(album) %>%
  summarise(duration=sum(duration)) %>%
  left_join(album_df, by="album") %>%
  mutate(count_per_sec=n/duration)

ggplot(album_df_b, aes(x=count_per_sec, y=fct_rev(album))) +
  geom_lollipop(point.colour="firebrick", point.size=2, horizontal=TRUE) +
  theme_ipsum(grid="X", base_size = 14, axis_title_size = 14, caption_size = 12,
              plot_title_size = 18, subtitle_size = 14) +
  labs(title="Words-per-second in Kanye West albums",
       x=NULL,
       y=NULL,
       subtitle="Records in chronological order",
       caption="Lyric data from genius.com")
```

Again, as expected, *808s* hangs back in the words-per-second stakes. *The Life Of Pablo* (TLOP) exhibits a lyrical pace more comparable to Kanye's earlier albums (*College Dropout* stays top, still). It's trickier to say for sure if his flow/delivery is a throwback from this metric alone (would be more optimal if tempo was incorporated into this equation, and remember that this figure includes breakdowns, outros, etc.) but maybe someone's been listening...

```{r echo = FALSE, out.width = "75%", fig.align = "center"}
knitr::include_graphics("/img/2017-03-20-Kanye_sentiment_analysis/kanye_tweets.png")
```

It's worth taking a look at how some of this looks across tracks, too.

```{r echo=FALSE}

tidy_df %>%
  count(n(), name) %>%
  ggplot() +
  geom_histogram(aes(n), fill="firebrick") +
  scale_x_comma(breaks = seq(0, 3000, by=500), limits = c(0, 3000)) +
  theme_ipsum(base_size = 14, axis_title_size = 14, caption_size = 12,
              plot_title_size = 18, subtitle_size = 14) +
  annotate("text", label = "'Last Call'", x = 2800, y = 2) +
  labs(title="Distribution of word counts in Kanye West album tracks",
       x="Word count",
       y="No. of tracks",
       caption="Lyric data from genius.com")
```

'Last Call' stands lone and tall at **2,745** words, with most in and around the 500-mark. However, 'Last Call' is also the *longest* Kanye album track (12:40(!!)). As before, what happens if we normalise by track length?

```{r, echo=FALSE}

tidy_df %>%
  group_by(name) %>%
  summarise(word_count=n()) %>%
  left_join(df, by="name") %>%
  mutate(count_per_sec=word_count/duration) %>%
  ggplot() +
  geom_histogram(aes(count_per_sec), fill="firebrick") +
  theme_ipsum(base_size = 14, axis_title_size = 14, caption_size = 12,
              plot_title_size = 18, subtitle_size = 14) +
  annotate("text", label = "'Freestyle 4'", x = 8.3, y = 2) +
  labs(title="Words-per-second distribution of Kanye West album tracks",
       x="Words per Second",
       y="No. of tracks",
       caption="Lyric data from genius.com")
```

Now, 'Freestyle 4' off of *TLOP* is highest - remember, this metric of lyrical density is inclusive of breakdowns and such. If you listen to this track which is just over two-minutes long, you'll see there is literally no let-up from the big man.

For good measure, let's end this section with a quick look at the range of lyric counts by record (hint: excuse for the dumbbell chart):

```{r echo=FALSE}
df %>%
  group_by(album) %>%
  summarise(min=min(duration), max=max(duration)) %>%
  ggplot(aes(y=fct_rev(album), x=min, xend=max)) + 
  geom_dumbbell(size=3, color="#e3e2e1", 
                colour_x = "firebrick", colour_xend = "firebrick",
                dot_guide=TRUE, dot_guide_size=0.25) +
  scale_x_continuous(breaks = seq(0, 800, by=200)) +
  labs(x="Seconds", y=NULL, title="Range of track lengths in Kanye West albums",
       caption="Lyric data from genius.com") +
  theme_ipsum(base_size = 14, axis_title_size = 14, caption_size = 12,
              plot_title_size = 18, subtitle_size = 14)
```

How similar are *Graduation*, *808s* and *Yeezus*?

## Feelings

We've touched on things like the word count and lyrical density of Kanye's records. Now, lets start to explore what is actually being said.

*Note: from this point on, English 'stop words' (e.g. and, or, but) are excluded from the analysis.*

```{r echo=FALSE}
sentiment_df %>%
  group_by(word) %>%
  summarise(count=n()) %>%
  top_n(n=10, wt=count) %>%
  ggplot(aes(x=reorder(str_to_upper(word), -count), y=count)) +
  geom_lollipop(point.colour="firebrick", point.size=2) +
  theme_ipsum(base_size = 14, axis_title_size = 14, caption_size = 12,
              plot_title_size = 18, subtitle_size = 14) +
  labs(title="Most common lyrics in Kanye West albums",
       x=NULL,
       y=NULL,
       subtitle="Ranked by word count",
       caption="Lyric data from genius.com")

```

Kanye's confirmed it, everyone - love conquers all (even sh*t). We'll need to dig further to get into the emotion and the message contained in the tracks that embody these words, though.

```{r echo = FALSE, out.width = "75%", fig.align = "center"}
knitr::include_graphics("/img/2017-03-20-Kanye_sentiment_analysis/kanye_croissants.gif")
```

I tried to quantify the amount of different types of sentiment in Kanye's lyrics by using `tidytext`. In this case, I went with the [NRC lexicon](http://saifmohammad.com/WebPages/NRC-Emotion-Lexicon.htm) developed by Saif Mohammad which associates words with some sentiment categories: positive, negative, anger, anticipation, disgust, fear, joy, sadness, surprise, and trust. As a Psychology graduate with some experience in qualitative analysis (and as a music lover, first and foremost) I'm mindful that a lexicon is a simplification that will undoubtedly miss important contextual and cultural cues (especially important in understanding art that nod to lots of subcultures), but can provide us with a useful summary in evaluating the lyric's emotional composition.

```{r, echo=FALSE}
nrc <- sentiments %>%
  filter(lexicon == "nrc") %>%
  select(word, sentiment)

albums <- sentiment_df %>%
  group_by(album) %>%
  mutate(total_words = n()) %>%
  ungroup() %>%
  distinct(album, total_words)

by_album_sentiment <- sentiment_df %>%
  inner_join(nrc, by = "word") %>%
  count(sentiment, album) %>%
  ungroup() %>%
  complete(sentiment, album, fill = list(n = 0)) %>%
  inner_join(albums) %>%
  group_by(album, sentiment, total_words) %>%
  summarize(words = sum(n)) %>%
  mutate(album_prop=words/total_words) %>%
  ungroup()

by_album_sentiment %>%
  filter(!sentiment %in% c("negative", "positive", "trust", "fear")) %>%
  ggplot(aes(x=album, y=album_prop, group=sentiment, colour=sentiment)) +
  geom_line(size=1.5) +
  theme_ipsum(base_size = 14, axis_title_size = 14, grid="Y", caption_size = 11,
              plot_title_size = 18, subtitle_size = 14, axis_text_size = 8) +
  scale_color_ipsum() +
  scale_y_percent(limits = c(0, 0.1), breaks = seq(0, 0.1, by=0.02)) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 20)) +
  labs(title="Sentiment in Kanye West albums",
       x=NULL,
       y="% lyrics",
       subtitle="Powered by the NRC lexicon",
       caption="Lyric data from genius.com") +
  theme(axis.text.x=element_text(angle=45, hjust = 1, size=8)) +
  theme(legend.position="top")

```

So, what did we learn here? It looks like *Graduation's* lyrics have the highest (proportional) rate of anticipation and surprise sentiment, compared to the other records. Interestingly, this is in keeping with the themes captured in Takashi Murukami's cover art (below), where we see 'Dropout Bear' being thrust out into a new world.

```{r echo = FALSE, out.width = "75%", fig.align = "center"}
knitr::include_graphics("/img/2017-03-20-Kanye_sentiment_analysis/kanye_graduation.jpg")
```

*My Beautiful Dark Twisted Fantasy* has the highest rate of anger and disgust, comparitively. Again, these are prominent in George Condo's bastardized, surreal vision for the record.

```{r echo = FALSE, out.width = "75%", fig.align = "center"}
knitr::include_graphics("/img/2017-03-20-Kanye_sentiment_analysis/kanye_mbdtf.png")
```

Can we look at this record closer to see where these kinds of feelings are most prominent?

```{r echo=FALSE}
bing <- sentiments %>%
  filter(lexicon == "bing") %>%
  dplyr::select(word, sentiment)

tracks <- sentiment_df %>%
  group_by(name, album, track_no) %>%
  mutate(total_words = n()) %>%
  ungroup() %>%
  distinct(name, album, track_no, total_words)

by_track_sentiment <- sentiment_df %>%
  inner_join(bing, by = "word") %>%
  count(sentiment, name) %>%
  ungroup() %>%
  complete(sentiment, name, fill = list(n = 0)) %>%
  inner_join(tracks) %>%
  group_by(name, album, track_no, sentiment, total_words) %>%
  summarize(words = sum(n)) %>%
  spread(sentiment, words, fill = 0) %>%
  mutate(sentiment = positive - negative) %>%
  ungroup()

by_track_sentiment %>%
  filter(album == "My Beautiful Dark Twisted Fantasy") %>%
  ggplot(aes(x=sentiment, y=reorder(str_to_title(name), -track_no))) +
  geom_lollipop(point.colour="firebrick", point.size=2, horizontal=TRUE) +
  theme_ipsum(base_size = 14, axis_title_size = 14,  grid="Y", caption_size = 12,
              plot_title_size = 18, subtitle_size = 14) +
  labs(title="Ratio of negative/positive sentiment in \nMy Beautiful Dark Twisted Fantasy",
       x="Sentiment ratio (negative-positive)",
       y=NULL,
       subtitle="Powered by the Bing lexicon",
       caption="Lyric data from genius.com")
```

The above uses the [Bing lexicon](https://www.cs.uic.edu/~liub/FBS/sentiment-analysis.html#lexicon) to examine how positive/negative sentiment manifests by track in *My Beautiful Dark Twisted Fantasy*. 'Monster' is furthest to the left with the highest ratio of negative to positive sentiment in it's lyrics, followed closely by 'So Appalled'. In fact, 'All of the Lights' would appear to be the only real respite for 'positive' lyrical sentiment.

What if we apply this to the rest of the discography, and see which tracks score highest for positive/negative sentiment across the board?

```{r echo=FALSE}
by_track_sentiment %>%
  arrange(desc(sentiment)) %>%
  filter(row_number()<=10 | row_number()>=n()-10) %>%
  ggplot(aes(x=sentiment, y=reorder(str_to_title(name), sentiment))) +
  geom_lollipop(point.colour="firebrick", point.size=2, horizontal=TRUE) +
  theme_ipsum(base_size = 14, axis_title_size = 14,  grid="Y", caption_size = 12,
              plot_title_size = 18, subtitle_size = 14) +
  labs(title="Highest ratios of positive and negative sentiment in \nKanye West's album cuts",
       x="Sentiment ratio (negative-positive)",
       y=NULL,
       subtitle=" Powered by the Bing lexicon",
       caption="Lyric data from genius.com")
```

It might be surprising to see 'Amazing' way out in front (n.b. I explain Love Lockdown's perhaps false position in the conclusion). Remember, this is based on lyrics *only* - here's a reminder of the hook...

> *No matter what, you'll never take that from me,*
*My reign is as far as your eyes can see;*
*It's amazing, so amazing, so amazing, so amazing,*
*It's amazing, so amazing, so amazing, so amazing*
*It's amazing, so amazing, so amazing, so amazing*
*It's amazing, so amazing, so amazing, so amazing*
*It's amazing*

## Some last words

We were able to answer some novel questions with this analysis. How many lyrics are in Kanye's tracks and albums/tracks, and how are these distributed by track and within-track (lyrical density)? What lyrics are most common, and how can we summarise the emotional content of these lyrics using different categories of sentiment? How does this look at an album and track level?

Of course, we're missing the full story by just considering words as individual units and the relationship to sentiment in this way. Lyric's meaning often comes from their relation to each other. In future, one can try and get at this by exploring the co-occurrence of words, or consecutive sequences of words known as n-grams, and validating sentiment scores by understanding context (e.g. 'loving' preceded by 'not' in 'Love Lockdown' would not have been picked up here, hence why it scored unexpectedly high on 'positive' sentiment).

Finally, a treat for those who know. Thanks for letting me get in my zone.

```{r echo = FALSE, out.width = "75%", fig.align = "center"}
knitr::include_graphics("/img/2017-03-20-Kanye_sentiment_analysis/kanye_zone.jpg")
```

[^fullcode]: To keep the post concise I don't show all of the code, especially code that generates figures. You can find the full code [here](https://github.com/rbind/ewenme/blob/master/content/blog/kanye-records-sentiment-analysis.Rmd). **Update:** I was pretty green when I wrote this post, and the code quality reflected this. The data prep was very hacky and in no way reproducible, so I've removed that part (soz).
[^RCharlie]: some of these factors are captured by Spotify, as explored in [this piece](http://rcharlie.com/2017-02-16-fitteR-happieR/) (a big inspiration for this post). This data was not available for Kanye's full studio discography through the Spotify API, at the time of this analysis.
